; ASCII CHARACTERS
CR      EQU     0DH
LF      EQU     0AH
CTRLZ   EQU     1AH

; CP/M BDOS FUNCTIONS
RCONF   EQU     1
WCONF   EQU     2
RBUFF   EQU     10

; CP/M ADDRESSES
RBOOT   EQU     0
BDOS    EQU     5
TPA     EQU     100H

ORG     TPA
START:  LXI     SP,STAK

; MAIN PROGRAM - ADD TWO 3-DIGIT NUMBERS
MAIN:   CALL    TWOCR
CALL    SPMSG
DB      'ADD 3 Digit Numbers',0
CALL    TWOCR

; GET FIRST NUMBER
CALL    SPMSG
DB      'ENTER NUMBER: ',0
CALL    GETNUM
SHLD    NUM1

; GET SECOND NUMBER
CALL    SPMSG
DB      'ENTER SECOND NUMBER: ',0
CALL    GETNUM
SHLD    NUM2

; ADD THE NUMBERS
LHLD    NUM1
XCHG
LHLD    NUM2
DAD     D
SHLD    RESULT

; DISPLAY RESULT
CALL    CCRLF
CALL    SPMSG
DB      'SUM: ',0
LHLD    RESULT
CALL    PRTNUM

; ASK TO CONTINUE
CALL    CCRLF
CALL    SPMSG
DB      'AGAIN?',0
CALL    GETYN
JZ      MAIN

; EXIT TO CP/M
JMP     RBOOT

; GET A DECIMAL NUMBER FROM CONSOLE (0-999)
; RETURNS VALUE IN HL
GETNUM: CALL    CIMSG
CALL    CCRLF
LXI     H,INBUF+2
LXI     D,0

GNUM1:  MOV     A,M
ORA     A
JZ      GNUM2
CPI     '0'
JC      GNUM1X
CPI     '9'+1
JNC     GNUM1X

; MULTIPLY DE BY 10
PUSH    H
PUSH    D
MOV     H,D
MOV     L,E
DAD     H
DAD     H
POP     D
PUSH    D
DAD     D
DAD     H
POP     D
XCHG

; ADD DIGIT TO RESULT
POP     H
MOV     A,M
SUI     '0'
ADD     E
MOV     E,A
MVI     A,0
ADC     D
MOV     D,A

GNUM1X: INX     H
JMP     GNUM1

GNUM2:  XCHG
RET
